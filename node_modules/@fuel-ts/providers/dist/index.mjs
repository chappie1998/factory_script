var kt=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var st=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)};var ot=(r,e,t)=>(kt(r,e,"access private method"),t);import{hexlify as Mt}from"@ethersproject/bytes";import{NativeAssetId as it}from"@fuel-ts/constants";import{bn as At}from"@fuel-ts/math";var P=r=>{var a,n;let e,t;return Array.isArray(r)?(t=r[0],e=(a=r[1])!=null?a:it):(t=r.amount,e=(n=r.assetId)!=null?n:it),{assetId:Mt(e),amount:At(t)}};import i from"graphql-tag";var ct=(t=>(t.Spent="SPENT",t.Unspent="UNSPENT",t))(ct||{});var _=i`
  fragment transactionFragment on Transaction {
    id
    rawPayload
    status {
      type: __typename
      ... on SubmittedStatus {
        time
      }
      ... on SuccessStatus {
        block {
          id
        }
        time
        programState {
          returnType
          data
        }
      }
      ... on FailureStatus {
        block {
          id
        }
        time
        reason
      }
    }
  }
`,ut=i`
  fragment receiptFragment on Receipt {
    data
    rawPayload
  }
`,z=i`
  fragment coinFragment on Coin {
    utxoId
    owner
    amount
    assetId
    maturity
    status
    blockCreated
  }
`,Pt=i`
  fragment messageFragment on Message {
    amount
    sender
    recipient
    data
    nonce
    daHeight
  }
`,pt=i`
  fragment balanceFragment on Balance {
    owner
    amount
    assetId
  }
`,w=i`
  fragment blockFragment on Block {
    id
    height
    producer
    transactions {
      id
    }
    time
  }
`,wt=i`
  fragment chainInfoFragment on ChainInfo {
    name
    baseChainHeight
    peerCount
    consensusParameters {
      gasPriceFactor
      maxGasPerTx
      maxGasPerTx
      maxScriptLength
    }
    latestBlock {
      ...blockFragment
    }
  }
  ${w}
`,Qt=i`
  query getVersion {
    nodeInfo {
      nodeVersion
    }
  }
`,Dt=i`
  query getInfo {
    nodeInfo {
      nodeVersion
      minGasPrice
    }
  }
`,Lt=i`
  query getChain {
    chain {
      ...chainInfoFragment
    }
  }
  ${wt}
`,Ot=i`
  query getTransaction($transactionId: TransactionId!) {
    transaction(id: $transactionId) {
      ...transactionFragment
    }
  }
  ${_}
`,$t=i`
  query getTransactionWithReceipts($transactionId: TransactionId!) {
    transaction(id: $transactionId) {
      ...transactionFragment
      receipts {
        ...receiptFragment
      }
    }
  }
  ${_}
  ${ut}
`,Ft=i`
  query getTransactions($after: String, $before: String, $first: Int, $last: Int) {
    transactions(after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...transactionFragment
        }
      }
    }
  }
  ${_}
`,Ut=i`
  query getTransactionsByOwner(
    $owner: Address!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    transactionsByOwner(owner: $owner, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...transactionFragment
        }
      }
    }
  }
  ${_}
`,Et=i`
  query getBlock($blockId: BlockId, $blockHeight: U64) {
    block(id: $blockId, height: $blockHeight) {
      ...blockFragment
    }
  }
  ${w}
`,Nt=i`
  query getBlockWithTransactions($blockId: BlockId, $blockHeight: U64) {
    block(id: $blockId, height: $blockHeight) {
      ...blockFragment
      transactions {
        ...transactionFragment
      }
    }
  }
  ${w}
  ${_}
`,Vt=i`
  query getBlocks($after: String, $before: String, $first: Int, $last: Int) {
    blocks(after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...blockFragment
        }
      }
    }
  }
  ${w}
`,Ht=i`
  query getCoin($coinId: UtxoId!) {
    coin(utxoId: $coinId) {
      ...coinFragment
    }
  }
  ${z}
`,Wt=i`
  query getCoins(
    $filter: CoinFilterInput!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    coins(filter: $filter, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...coinFragment
        }
      }
    }
  }
  ${z}
`,Kt=i`
  query getCoinsToSpend(
    $owner: Address!
    $spendQuery: [SpendQueryElementInput!]!
    $maxInputs: Int
    $excludedIds: [UtxoId!]
  ) {
    coinsToSpend(
      owner: $owner
      spendQuery: $spendQuery
      maxInputs: $maxInputs
      excludedIds: $excludedIds
    ) {
      ...coinFragment
    }
  }
  ${z}
`,vt=i`
  query getContract($contractId: ContractId!) {
    contract(id: $contractId) {
      bytecode
      id
    }
  }
`,Zt=i`
  query getBalance($owner: Address!, $assetId: AssetId!) {
    balance(owner: $owner, assetId: $assetId) {
      ...balanceFragment
    }
  }
  ${pt}
`,zt=i`
  query getBalances(
    $filter: BalanceFilterInput!
    $after: String
    $before: String
    $first: Int
    $last: Int
  ) {
    balances(filter: $filter, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...balanceFragment
        }
      }
    }
  }
  ${pt}
`,Xt=i`
  query getMessages($owner: Address!, $after: String, $before: String, $first: Int, $last: Int) {
    messages(owner: $owner, after: $after, before: $before, first: $first, last: $last) {
      edges {
        node {
          ...messageFragment
        }
      }
    }
  }
  ${Pt}
`,Jt=i`
  mutation dryRun($encodedTransaction: HexString!, $utxoValidation: Boolean) {
    dryRun(tx: $encodedTransaction, utxoValidation: $utxoValidation) {
      ...receiptFragment
    }
  }
  ${ut}
`,Yt=i`
  mutation submit($encodedTransaction: HexString!) {
    submit(tx: $encodedTransaction) {
      id
    }
  }
`,jt=i`
  mutation startSession {
    startSession
  }
`,te=i`
  mutation endSession($sessionId: ID!) {
    endSession(id: $sessionId)
  }
`,ee=i`
  mutation execute($sessionId: ID!, $op: String!) {
    execute(id: $sessionId, op: $op)
  }
`,ae=i`
  mutation reset($sessionId: ID!) {
    reset(id: $sessionId)
  }
`,re=(r,e,t)=>r();function lt(r,e=re){return{getVersion(t,a){return e(n=>r.request(Qt,t,{...a,...n}),"getVersion","query")},getInfo(t,a){return e(n=>r.request(Dt,t,{...a,...n}),"getInfo","query")},getChain(t,a){return e(n=>r.request(Lt,t,{...a,...n}),"getChain","query")},getTransaction(t,a){return e(n=>r.request(Ot,t,{...a,...n}),"getTransaction","query")},getTransactionWithReceipts(t,a){return e(n=>r.request($t,t,{...a,...n}),"getTransactionWithReceipts","query")},getTransactions(t,a){return e(n=>r.request(Ft,t,{...a,...n}),"getTransactions","query")},getTransactionsByOwner(t,a){return e(n=>r.request(Ut,t,{...a,...n}),"getTransactionsByOwner","query")},getBlock(t,a){return e(n=>r.request(Et,t,{...a,...n}),"getBlock","query")},getBlockWithTransactions(t,a){return e(n=>r.request(Nt,t,{...a,...n}),"getBlockWithTransactions","query")},getBlocks(t,a){return e(n=>r.request(Vt,t,{...a,...n}),"getBlocks","query")},getCoin(t,a){return e(n=>r.request(Ht,t,{...a,...n}),"getCoin","query")},getCoins(t,a){return e(n=>r.request(Wt,t,{...a,...n}),"getCoins","query")},getCoinsToSpend(t,a){return e(n=>r.request(Kt,t,{...a,...n}),"getCoinsToSpend","query")},getContract(t,a){return e(n=>r.request(vt,t,{...a,...n}),"getContract","query")},getBalance(t,a){return e(n=>r.request(Zt,t,{...a,...n}),"getBalance","query")},getBalances(t,a){return e(n=>r.request(zt,t,{...a,...n}),"getBalances","query")},getMessages(t,a){return e(n=>r.request(Xt,t,{...a,...n}),"getMessages","query")},dryRun(t,a){return e(n=>r.request(Jt,t,{...a,...n}),"dryRun","mutation")},submit(t,a){return e(n=>r.request(Yt,t,{...a,...n}),"submit","mutation")},startSession(t,a){return e(n=>r.request(jt,t,{...a,...n}),"startSession","mutation")},endSession(t,a){return e(n=>r.request(te,t,{...a,...n}),"endSession","mutation")},execute(t,a){return e(n=>r.request(ee,t,{...a,...n}),"execute","mutation")},reset(t,a){return e(n=>r.request(ae,t,{...a,...n}),"reset","mutation")}}}import{arrayify as rt,hexlify as R}from"@ethersproject/bytes";import{AbiCoder as be}from"@fuel-ts/abi-coder";import{Address as Ct}from"@fuel-ts/address";import{NativeAssetId as ht}from"@fuel-ts/constants";import{max as qe,bn as u,multiply as xe}from"@fuel-ts/math";import{InputMessageCoder as fe,GAS_PRICE_FACTOR as Ge,MAX_GAS_PER_TX as Bt,ReceiptType as Rt,ReceiptCoder as Te,TransactionCoder as _t}from"@fuel-ts/transactions";import{GraphQLClient as Ce}from"graphql-request";import he from"lodash.clonedeep";import{arrayify as S,hexlify as I}from"@ethersproject/bytes";import{ZeroBytes32 as X}from"@fuel-ts/constants";import{bn as J,toNumber as Q}from"@fuel-ts/math";import{InputType as f}from"@fuel-ts/transactions";var yt=r=>{var e,t,a,n,s;switch(r.type){case f.Coin:{let o=S((e=r.predicate)!=null?e:"0x"),c=S((t=r.predicateData)!=null?t:"0x");return{type:f.Coin,utxoID:{transactionId:I(S(r.id).slice(0,32)),outputIndex:S(r.id)[32]},owner:I(r.owner),amount:J(r.amount),assetId:I(r.assetId),txPointer:{blockHeight:Q(S(r.txPointer).slice(0,8)),txIndex:Q(S(r.txPointer).slice(8,16))},witnessIndex:r.witnessIndex,maturity:(a=r.maturity)!=null?a:0,predicateLength:o.length,predicateDataLength:c.length,predicate:I(o),predicateData:I(c)}}case f.Contract:return{type:f.Contract,utxoID:{transactionId:X,outputIndex:0},balanceRoot:X,stateRoot:X,txPointer:{blockHeight:Q(S(r.txPointer).slice(0,8)),txIndex:Q(S(r.txPointer).slice(8,16))},contractID:I(r.contractId)};case f.Message:{let o=S((n=r.predicate)!=null?n:"0x"),c=S((s=r.predicateData)!=null?s:"0x");return{type:f.Message,sender:I(r.sender),recipient:I(r.recipient),amount:J(r.amount),nonce:J(r.nonce),witnessIndex:r.witnessIndex,dataLength:r.data.length,predicateLength:o.length,predicateDataLength:c.length,data:r.data,predicate:I(o),predicateData:I(c)}}default:throw new Error("Invalid Input type")}};import{hexlify as q}from"@ethersproject/bytes";import{ZeroBytes32 as D}from"@fuel-ts/constants";import{bn as L}from"@fuel-ts/math";import{OutputType as d}from"@fuel-ts/transactions";var dt=r=>{switch(r.type){case d.Coin:return{type:d.Coin,to:q(r.to),amount:L(r.amount),assetId:q(r.assetId)};case d.Contract:return{type:d.Contract,inputIndex:r.inputIndex,balanceRoot:D,stateRoot:D};case d.Withdrawal:return{type:d.Withdrawal,to:q(r.to),amount:L(r.amount),assetId:q(r.assetId)};case d.Change:return{type:d.Change,to:q(r.to),amount:L(0),assetId:q(r.assetId)};case d.Variable:return{type:d.Variable,to:D,amount:L(0),assetId:D};case d.ContractCreated:return{type:d.ContractCreated,contractId:q(r.contractId),stateRoot:q(r.stateRoot)};default:throw new Error("Invalid Output type")}};import{arrayify as G,hexlify as C}from"@ethersproject/bytes";import{addressify as M,Address as ye}from"@fuel-ts/address";import{NativeAssetId as qt,ZeroBytes32 as j}from"@fuel-ts/constants";import{bn as F}from"@fuel-ts/math";import{TransactionType as h,TransactionCoder as de,InputType as T,OutputType as m,GAS_PRICE_FACTOR as me}from"@fuel-ts/transactions";import{sha256 as ne}from"@ethersproject/sha2";import{ZeroBytes32 as x}from"@fuel-ts/constants";import{bn as O}from"@fuel-ts/math";import{ReceiptType as mt,InputType as se,OutputType as Y,TransactionType as gt,TransactionCoder as oe}from"@fuel-ts/transactions";var ie=r=>{let e={...r};switch(e.type){case gt.Script:{e.receiptsRoot=x;break}case gt.Create:break;default:throw new Error("Not implemented")}return e.inputs=e.inputs.map(t=>t.type===se.Contract?{...t,utxoID:{transactionId:x,outputIndex:0},balanceRoot:x,stateRoot:x}:t),e.outputs=e.outputs.map(t=>{switch(t.type){case Y.Contract:return{...t,balanceRoot:x,stateRoot:x};case Y.Change:return{...t,amount:O(0)};case Y.Variable:return{...t,to:x,amount:O(0),assetId:x};default:return t}}),e},Ye=r=>{let e=ie(r),t=new oe().encode(e);return ne(t)},$=(r,e,t)=>O(Math.ceil(r.toNumber()/t.toNumber())*e.toNumber()),k=r=>{let e=r.find(t=>t.type===mt.ScriptResult);return e&&e.type===mt.ScriptResult?e.gasUsed:O(0)};import{hexlify as St,arrayify as ce}from"@ethersproject/bytes";var ue=r=>{let e=new Uint8Array(32);return e.set(ce(r)),e},It=r=>{let e,t;return Array.isArray(r)?(e=r[0],t=r[1]):(e=r.key,t=r.value),{key:St(e),value:St(ue(t))}};import{arrayify as pe,hexlify as le}from"@ethersproject/bytes";var bt=r=>{let e=pe(r);return{data:le(e),dataLength:e.length}};var xt={bytes:G("0x24000000"),encodeScriptData:()=>new Uint8Array(0)},tt=class extends Error{constructor(){super(...arguments);this.name="ChangeOutputCollisionError";this.message='A ChangeOutput with the same "assetId" already exists for a different "to" address'}},et=class extends Error{constructor(t){super();this.index=t;this.name="NoWitnessAtIndexError";this.message=`Witness at index "${t}" was not found`}},at=class extends Error{constructor(t){super();this.owner=t;this.name="NoWitnessByOwnerError";this.message=`A witness for the given owner "${t}" was not found`}},U=class{constructor({gasPrice:e,gasLimit:t,maturity:a,inputs:n,outputs:s,witnesses:o}={}){this.inputs=[];this.outputs=[];this.witnesses=[];this.gasPrice=F(e!=null?e:0),this.gasLimit=F(t!=null?t:0),this.maturity=a!=null?a:0,this.inputs=[...n!=null?n:[]],this.outputs=[...s!=null?s:[]],this.witnesses=[...o!=null?o:[]]}getBaseTransaction(){var n,s,o,c,b,g;let e=(s=(n=this.inputs)==null?void 0:n.map(yt))!=null?s:[],t=(c=(o=this.outputs)==null?void 0:o.map(dt))!=null?c:[],a=(g=(b=this.witnesses)==null?void 0:b.map(bt))!=null?g:[];return{gasPrice:this.gasPrice,gasLimit:this.gasLimit,maturity:this.maturity,inputs:e,outputs:t,witnesses:a,inputsCount:e.length,outputsCount:t.length,witnessesCount:a.length}}toTransactionBytes(){return new de().encode(this.toTransaction())}pushInput(e){return this.inputs.push(e),this.inputs.length-1}pushOutput(e){return this.outputs.push(e),this.outputs.length-1}createWitness(){return this.witnesses.push("0x"),this.witnesses.length-1}updateWitness(e,t){if(!this.witnesses[e])throw new et(e);this.witnesses[e]=t}getCoinInputs(){return this.inputs.filter(e=>e.type===T.Coin)}getCoinOutputs(){return this.outputs.filter(e=>e.type===m.Coin)}getChangeOutputs(){return this.outputs.filter(e=>e.type===m.Change)}getCoinInputWitnessIndexByOwner(e){var a,n;let t=M(e);return(n=(a=this.inputs.find(s=>s.type===T.Coin&&s.owner===t.toB256()))==null?void 0:a.witnessIndex)!=null?n:null}updateWitnessByCoinInputOwner(e,t){let a=this.getCoinInputWitnessIndexByOwner(e);if(!a)throw new at(M(e));this.updateWitness(a,t)}addCoin(e){let t=this.getCoinInputWitnessIndexByOwner(ye.fromB256(e.owner));typeof t!="number"&&(t=this.createWitness()),this.pushInput({type:T.Coin,...e,witnessIndex:t,txPointer:"0x00000000000000000000000000000000"});let a=this.getChangeOutputs().find(n=>C(n.assetId)===e.assetId);if(a&&C(a.to)!==e.owner)throw new tt;a||this.pushOutput({type:m.Change,to:e.owner,assetId:e.assetId})}addCoins(e){e.forEach(t=>this.addCoin(t))}addCoinOutput(e,t,a=qt){this.pushOutput({type:m.Coin,to:M(e).toB256(),amount:t,assetId:a})}addCoinOutputs(e,t){t.map(P).forEach(a=>{this.pushOutput({type:m.Coin,to:M(e).toB256(),amount:a.amount,assetId:a.assetId})})}byteSize(){return this.toTransactionBytes().length}chargeableByteSize(){let e=this.witnesses.reduce((t,a)=>t+G(a).length,0);return F(this.toTransactionBytes().length-e)}calculateFee(){let e=$(this.gasLimit,this.gasPrice,me);return{assetId:qt,amount:e.isZero()?F(1):e}}addMessage(e){let t=this.getCoinInputWitnessIndexByOwner(e.recipient);typeof t!="number"&&(t=this.createWitness()),this.pushInput({type:T.Message,...e,sender:e.sender.toBytes(),recipient:e.recipient.toBytes(),witnessIndex:t})}addMessages(e){e.forEach(t=>this.addMessage(t))}},B=class extends U{constructor({script:t,scriptData:a,...n}={}){super(n);this.type=h.Script;this.script=G(t!=null?t:xt.bytes),this.scriptData=G(a!=null?a:xt.encodeScriptData())}static from(t){return t instanceof this?t:new this(t)}toTransaction(){var n,s;let t=G((n=this.script)!=null?n:"0x"),a=G((s=this.scriptData)!=null?s:"0x");return{type:h.Script,...super.getBaseTransaction(),scriptLength:t.length,scriptDataLength:a.length,receiptsRoot:j,script:C(t),scriptData:C(a)}}getContractInputs(){return this.inputs.filter(t=>t.type===T.Contract)}getContractOutputs(){return this.outputs.filter(t=>t.type===m.Contract)}getVariableOutputs(){return this.outputs.filter(t=>t.type===m.Variable)}setScript(t,a){this.script=t.bytes,this.scriptData=t.encodeScriptData(a),this.bytesOffset===void 0&&(this.bytesOffset=this.scriptData.byteLength)}addVariableOutputs(t=1){let a=t;for(;a;)this.pushOutput({type:m.Variable}),a-=1;return this.outputs.length-1}addContract(t){let a=M(t);if(this.getContractInputs().find(s=>s.contractId===a.toB256()))return;let n=super.pushInput({type:T.Contract,contractId:a.toB256(),txPointer:"0x00000000000000000000000000000000"});this.pushOutput({type:m.Contract,inputIndex:n})}},E=class extends U{constructor({bytecodeWitnessIndex:t,salt:a,storageSlots:n,...s}={}){super(s);this.type=h.Create;this.bytecodeWitnessIndex=t!=null?t:0,this.salt=C(a!=null?a:j),this.storageSlots=[...n!=null?n:[]]}static from(t){return t instanceof this?t:new this(t)}toTransaction(){var s,o;let t=this.getBaseTransaction(),a=this.bytecodeWitnessIndex,n=(o=(s=this.storageSlots)==null?void 0:s.map(It))!=null?o:[];return{type:h.Create,...t,bytecodeLength:t.witnesses[a].dataLength/4,bytecodeWitnessIndex:a,storageSlotsCount:n.length,salt:this.salt?C(this.salt):j,storageSlots:n}}getContractCreatedOutputs(){return this.outputs.filter(t=>t.type===m.ContractCreated)}addContractCreatedOutput(t,a){this.pushOutput({type:m.ContractCreated,contractId:t,stateRoot:a})}},N=r=>{if(r instanceof B||r instanceof E)return r;switch(r.type){case h.Script:return B.from(r);case h.Create:return E.from(r);default:throw new Error(`Unknown transaction type: ${r.type}`)}};import{arrayify as ge}from"@ethersproject/bytes";import{bn as Se}from"@fuel-ts/math";import{ReceiptType as ft,ReceiptCoder as Ie}from"@fuel-ts/transactions";var Gt=r=>{let e=new Ie().decode(ge(r.rawPayload),0)[0];switch(e.type){case ft.ReturnData:return{...e,data:r.data};case ft.LogData:return{...e,data:r.data};default:return e}},H,Tt,V=class{constructor(e,t,a){st(this,H);this.gasUsed=Se(0);this.id=e,this.request=t,this.provider=a}async waitForResult(){var t;let e=await ot(this,H,Tt).call(this);switch((t=e.status)==null?void 0:t.type){case"SubmittedStatus":throw new Error("Not yet implemented");case"FailureStatus":{let a=e.receipts.map(Gt);return this.gasUsed=k(a),{status:{type:"failure",reason:e.status.reason},receipts:a,transactionId:this.id,blockId:e.status.block.id,time:e.status.time}}case"SuccessStatus":{let a=e.receipts.map(Gt);return this.gasUsed=k(a),{status:{type:"success",programState:e.status.programState},receipts:a,transactionId:this.id,blockId:e.status.block.id,time:e.status.time}}default:throw new Error("Invalid Transaction status")}}async wait(){let e=await this.waitForResult();if(e.status.type==="failure")throw new Error(`Transaction failed: ${e.status.reason}`);return e}};H=new WeakSet,Tt=async function(){let{transaction:e}=await this.provider.operations.getTransactionWithReceipts({transactionId:this.id});if(!e)throw new Error("No Transaction was received from the client.");return e};var Be=r=>{let e=new Te().decode(rt(r.rawPayload),0)[0];switch(e.type){case Rt.ReturnData:return{...e,data:r.data};case Rt.LogData:return{...e,data:r.data};default:return e}},Re=r=>({name:r.name,baseChainHeight:u(r.baseChainHeight),peerCount:r.peerCount,consensusParameters:{gasPriceFactor:u(r.consensusParameters.gasPriceFactor),maxGasPerTx:u(r.consensusParameters.maxGasPerTx),maxScriptLength:u(r.consensusParameters.maxScriptLength)},latestBlock:{id:r.latestBlock.id,height:u(r.latestBlock.height),producer:r.latestBlock.producer,time:r.latestBlock.time,transactions:r.latestBlock.transactions.map(e=>({id:e.id}))}}),_e=r=>({minGasPrice:u(r.minGasPrice),nodeVersion:r.nodeVersion}),W=class{constructor(e){this.url=e;let t=new Ce(e);this.operations=lt(t)}async getVersion(){let{nodeInfo:{nodeVersion:e}}=await this.operations.getVersion();return e}async getNetwork(){return{name:"fuelv2",chainId:3735928559}}async getBlockNumber(){let{chain:e}=await this.operations.getChain();return u(e.latestBlock.height,10)}async getNodeInfo(){let{nodeInfo:e}=await this.operations.getInfo();return _e(e)}async getChain(){let{chain:e}=await this.operations.getChain();return Re(e)}async sendTransaction(e){let t=N(e),a=R(t.toTransactionBytes()),{gasUsed:n,minGasPrice:s}=await this.getTransactionCost(t,0);if(u(n).gt(u(t.gasLimit)))throw new Error(`gasLimit(${t.gasLimit}) is lower than the required (${n})`);if(u(s).gt(u(t.gasPrice)))throw new Error(`gasPrice(${t.gasPrice}) is lower than the required ${s}`);let{submit:{id:o}}=await this.operations.submit({encodedTransaction:a});return new V(o,t,this)}async call(e,{utxoValidation:t}={}){let a=N(e),n=R(a.toTransactionBytes()),{dryRun:s}=await this.operations.dryRun({encodedTransaction:n,utxoValidation:t||!1});return{receipts:s.map(Be)}}async getTransactionCost(e,t=.2){let a=N(he(e)),{minGasPrice:n}=await this.getNodeInfo(),s=qe(a.gasPrice,n),o=1+t;a.gasLimit=Bt,a.gasPrice=u(0);let{receipts:c}=await this.call(a),b=xe(k(c),o),g=$(b,s,Ge);return{minGasPrice:n,gasPrice:s,gasUsed:b,fee:g}}async getCoins(e,t,a){return(await this.operations.getCoins({first:10,...a,filter:{owner:e.toB256(),assetId:t&&R(t)}})).coins.edges.map(o=>o.node).map(o=>({id:o.utxoId,assetId:o.assetId,amount:u(o.amount),owner:o.owner,status:o.status,maturity:u(o.maturity).toNumber(),blockCreated:u(o.blockCreated)}))}async getCoinsToSpend(e,t,a,n){return(await this.operations.getCoinsToSpend({owner:e.toB256(),spendQuery:t.map(P).map(c=>({assetId:R(c.assetId),amount:c.amount.toString(10)})),maxInputs:a,excludedIds:n==null?void 0:n.map(c=>R(c))})).coinsToSpend.map(c=>({id:c.utxoId,status:c.status,assetId:c.assetId,amount:u(c.amount),owner:c.owner,maturity:u(c.maturity).toNumber(),blockCreated:u(c.blockCreated)}))}async getBlock(e){let t;typeof e=="number"?t={blockHeight:u(e).toString(10)}:e==="latest"?t={blockHeight:(await this.getBlockNumber()).toString(10)}:t={blockId:u(e).toString(10)};let{block:a}=await this.operations.getBlock(t);return a?{id:a.id,height:u(a.height),time:a.time,producer:a.producer,transactionIds:a.transactions.map(n=>n.id)}:null}async getBlockWithTransactions(e){let t;typeof e=="number"?t={blockHeight:u(e).toString(10)}:e==="latest"?t={blockHeight:(await this.getBlockNumber()).toString()}:t={blockId:e};let{block:a}=await this.operations.getBlockWithTransactions(t);return a?{id:a.id,height:u(a.height,10),time:a.time,producer:a.producer,transactionIds:a.transactions.map(n=>n.id),transactions:a.transactions.map(n=>{var s;return(s=new _t().decode(rt(n.rawPayload),0))==null?void 0:s[0]})}:null}async getTransaction(e){var a;let{transaction:t}=await this.operations.getTransaction({transactionId:e});return t?(a=new _t().decode(rt(t.rawPayload),0))==null?void 0:a[0]:null}async getContract(e){let{contract:t}=await this.operations.getContract({contractId:e});return t||null}async getBalance(e,t){let{balance:a}=await this.operations.getBalance({owner:e.toB256(),assetId:R(t)});return u(a.amount,10)}async getBalances(e,t){return(await this.operations.getBalances({first:10,...t,filter:{owner:e.toB256()}})).balances.edges.map(s=>s.node).map(s=>({assetId:s.assetId,amount:u(s.amount)}))}async getMessages(e,t){return(await this.operations.getMessages({first:10,...t,owner:e.toB256()})).messages.edges.map(s=>s.node).map(s=>({amount:u(s.amount),sender:Ct.fromAddressOrString(s.sender),recipient:Ct.fromAddressOrString(s.recipient),data:fe.decodeData(s.data),daHeight:u(s.daHeight),nonce:u(s.nonce)}))}async buildSpendPredicate(e,t,a,n,s=ht,o,c){let b=await this.getCoinsToSpend(e.address,[[t,s]]),g={fundTransaction:!0,...o},y=new B({gasLimit:Bt,...g}),K;n&&e.types&&(K=new be().encode(e.types,n));let v=b.reduce((A,nt)=>(y.addCoin({...nt,predicate:e.bytes,predicateData:K}),y.outputs=[],A.add(nt.amount)),u(0));y.addCoinOutput(a,v,s);let Z=[];if(g.fundTransaction&&Z.push(y.calculateFee()),Z.length&&c){let A=await this.getCoinsToSpend(c,Z);y.addCoins(A)}return y}async submitSpendPredicate(e,t,a,n,s=ht,o,c){var g;let b=await this.buildSpendPredicate(e,t,a,n,s,o,c);try{return await(await this.sendTransaction(b)).waitForResult()}catch(y){throw(((g=y==null?void 0:y.response)==null?void 0:g.errors)||[]).some(({message:v})=>v.includes("unexpected block execution error TransactionValidity(InvalidPredicate"))?new Error("Invalid Predicate"):y}}};export{tt as ChangeOutputCollisionError,ct as CoinStatus,E as CreateTransactionRequest,et as NoWitnessAtIndexError,at as NoWitnessByOwnerError,W as Provider,B as ScriptTransactionRequest,V as TransactionResponse,h as TransactionType,$ as calculatePriceWithFactor,P as coinQuantityfy,k as getGasUsedFromReceipts,ie as getSignableTransaction,Ye as getTransactionId,yt as inputify,dt as outputify,xt as returnZeroScript,N as transactionRequestify};
//# sourceMappingURL=index.mjs.map